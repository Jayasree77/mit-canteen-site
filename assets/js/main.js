var newMenu = [
    {
        "sys": { "id": "1" },
        "fields": {
            "title": "Double Cheese Potato Burger",
            "category": "Burger",
            "price": "45",
            "caleories": "220 - 280 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/burger.jpg" } } }
        }
    },
    {
        "sys": { "id": "2" },
        "fields": {
            "title": "Cheese Sandwitch",
            "category": "Sandwitch",
            "price": "45",
            "caleories": "250 - 300 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/sandwich1.jpg" } } }
        }
    },
    {
        "sys": { "id": "3" },
        "fields": {
            "title": "Veg Club Sandwitch",
            "category": "Sandwitch",
            "price": "60",
            "caleories": "320 - 400 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/s2.jpg" } } }
        }
    },
    {
        "sys": { "id": "4" },
        "fields": {
            "title": "Cheese Masala Sandwitch",
            "category": "Sandwitch",
            "price": "45",
            "caleories": "250 - 300 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/sandwich2.jpg" } } }
        }
    },
    {
        "sys": { "id": "5" },
        "fields": {
            "title": "Veg Schezuan Sandwitch",
            "category": "Sandwitch",
            "price": "45",
            "caleories": "230 - 285 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/schez-sandwitch.jpg" } } }
        }
    },
    {
        "sys": { "id": "6" },
        "fields": {
            "title": "Masala Maggie",
            "category": "Maggie",
            "price": "25",
            "caleories": "150 - 280 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/maggie.jpg" } } }
        }
    },
    {
        "sys": { "id": "7" },
        "fields": {
            "title": "Schezuan Maggie",
            "category": "Maggie",
            "price": "30",
            "caleories": "165 - 225 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/maggie-s.jpg" } } }
        }
    },
    {
        "sys": { "id": "8" },
        "fields": {
            "title": "Veg Maggie",
            "category": "Maggie",
            "price": "30",
            "caleories": "170 - 220 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/veg-maggie.jpg" } } }
        }
    },
    {
        "sys": { "id": "9" },
        "fields": {
            "title": "Cheese Garlic Maggie",
            "category": "Maggie",
            "price": "40",
            "caleories": "190 - 230 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/garlic-maggie.jpg" } } }
        }
    },
    {
        "sys": { "id": "10" },
        "fields": {
            "title": "Cheese Veg Maggie",
            "category": "Maggie",
            "price": "45",
            "caleories": "175 - 235 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/cheese-maggie.jpg" } } }
        }
    },
    {
        "sys": { "id": "11" },
        "fields": {
            "title": "Masala Fries",
            "category": "Fries",
            "price": "35",
            "caleories": "120 - 185 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/frenchfries.jpg" } } }
        }
    },
    {
        "sys": { "id": "12" },
        "fields": {
            "title": "Schezuan Fries",
            "category": "Fries",
            "price": "45",
            "caleories": "135 - 210 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/shezuan.jpg" } } }
        }
    },
    {
        "sys": { "id": "13" },
        "fields": {
            "title": "Cheese Fries",
            "category": "Fries",
            "price": "40",
            "caleories": "140 - 156 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/cheese-fries.jpg" } } }
        }
    },
    {
        "sys": { "id": "14" },
        "fields": {
            "title": "Red Sause Pasta",
            "category": "Pasta",
            "price": "80",
            "caleories": "241 - 321 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/pasta.jpg" } } }
        }
    },
    {
        "sys": { "id": "15" },
        "fields": {
            "title": "White Sause Pasta",
            "category": "Pasta",
            "price": "80",
            "caleories": "265 - 321 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/white-pasta.jpg" } } }
        }
    },
    {
        "sys": { "id": "16" },
        "fields": {
            "title": "Milk Shakes",
            "category": "Beverages",
            "price": "35",
            "caleories": "155 - 210 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/milk-shake.jpg" } } }
        }
    },
    {
        "sys": { "id": "17" },
        "fields": {
            "title": "Hot Chocolate",
            "category": "Beverages",
            "price": "35",
            "caleories": "230 - 280 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/hot-coffee.jpg" } } }
        }
    },
    {
        "sys": { "id": "18" },
        "fields": {
            "title": "Aerated Drinks",
            "category": "Beverages",
            "price": "10",
            "caleories": "260 - 365 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/Aerated-Drinks.jpg" } } }
        }
    },
    {
        "sys": { "id": "19" },
        "fields": {
            "title": "Cold Coffee",
            "category": "Beverages",
            "price": "35",
            "caleories": "255 - 360 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/cold-coffee.jpg" } } }
        }
    },
    {
        "sys": { "id": "20" },
        "fields": {
            "title": "Coffee",
            "category": "Beverages",
            "price": "15",
            "caleories": "220 - 265 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/coffee.jpg" } } }
        }
    },
    {
        "sys": { "id": "21" },
        "fields": {
            "title": "Tea",
            "category": "Beverages",
            "price": "10",
            "caleories": "155 - 225 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/tea.jpg" } } }
        }
    },
    {
        "sys": { "id": "22" },
        "fields": {
            "title": "Chocate Frappe",
            "category": "Beverages",
            "price": "35",
            "caleories": "265 - 355 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/beverage.jpg" } } }
        }
    },
    {
        "sys": { "id": "23" },
        "fields": {
            "title": "Veg Puff",
            "category": "Bakery",
            "price": "35",
            "caleories": "260 - 320 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/puff.jpg" } } }
        }
    },
    {
        "sys": { "id": "24" },
        "fields": {
            "title": "Panner Puff",
            "category": "Bakery",
            "price": "15",
            "caleories": "255 - 390 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/samosa.jpg" } } }
        }
    },
    {
        "sys": { "id": "25" },
        "fields": {
            "title": "Khari",
            "category": "Bakery",
            "price": "20",
            "caleories": "265 - 375 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/panner-puff.jpg" } } }
        }
    },
    {
        "sys": { "id": "26" },
        "fields": {
            "title": "Noodle Puff",
            "category": "Bakery",
            "price": "15",
            "caleories": "300 - 425 Kcal",
            "image": { "fields": {"file": { "url": "assets/images/noodle-puff.jpg" } } }
        }
    }
]

// Menu Section -
const menuSection = document.querySelector('.menu-section');
// Menu Filter Buttons -
const menuFilterBtns = document.querySelectorAll('#menu-filter');

// Menu Filteration
menuFilterBtns.forEach( btn => {
    btn.addEventListener('click', (e)=>{
        const Category = e.currentTarget.dataset.id;

        // Current Btn Indication - 
        btn.classList.add('current')
        menuFilterBtns.forEach(i =>{
            if(i.dataset.id != Category){i.classList.remove('current')}
        })

        // Add Menu Items by Category - 
        const menuCategory = newMenu.filter(function(menuItem){
            if (menuItem.fields.category === Category){ return menuItem }
        });

        // ShortHand If/else Stuff -
        Category === 'all' ? displayMenuItems(newMenu) : displayMenuItems(menuCategory);
    })
})

// Function To Create Menu Cards & Add to HTML
function displayMenuItems(menuItems){
    let displayMenu = menuItems.map(function(item){
        return `
        <article class="menu-item">
            <img src="${item.fields.image.fields.file.url}" loading="lazy" alt="Product image">
            <div class="item-info">
            <figure>
                <h2>${item.fields.title}</h2>
                <div class="item-category">${item.fields.category}</div>
                <div class="flex" style="margin-top: 10px;">
                    <i class="fas fa-fire"></i>
                    <p>${item.fields.caleories}</p>
                </div>
            </figure>
            <hr style="margin: 10px 0;">
            <div class="menu-cart-functionality">
                <div class="price">$${item.fields.price}</div>
                <div class="cart-btn-container">
                    <button class="bag-btn" id="add-to-cart-btn" data-id=${item.sys.id}>Add to Cart</i></button>
                </div>
            </div>
            </div>
        </article>
        `;
    });

    displayMenu = displayMenu.join('');
    if (menuSection) {menuSection.innerHTML = displayMenu;}
}

// ------------------ Menu.html Menu Cards END ------------------------

// --- Product functioning ---
class Products {
// Add Products To Admin Pannel -
AdminAddProduct() { /* To Admin Database */ }

// Add Products To Admin Pannel -
AdminRemoveProduct() { /* To Admin Database */ }

// Add Update Product To Admin Pannel -
AdminUpdateProduct() { /* To Admin Database */ }

// Get products and display them to customer menu panel -
getProducts() { }

}
  
// Local Storage
class Storage {
    static saveProducts(products){
          localStorage.setItem('products', JSON.stringify(products));
    }

    static getProduct(id) {
        // goes into Browser -> Application -> localStorage -> method(getItem(stuff here it is array)) -> 
        let products = JSON.parse(localStorage.getItem('products')); 
        return products.find(product => product.id === id)
    }

    static saveCart(cart){
        localStorage.setItem('cart', JSON.stringify(cart));
    }

    static getCart(){
        return localStorage.getItem('cart')?JSON.parse
        (localStorage.getItem('cart')):[]
    }
}

// --- Cart Functioning ---
// Inside Cart Container
const cartItemsContainer = document.querySelector('.cart-items-container');
// Nav Cart Items Indicator
const cartItems = document.querySelector('.cart-items');
// Total Bill
const cartTotal = document.querySelector('.cart-total');

// Clear Cart Btn
const clearCart = document.querySelector('.clear-cart');

const navcartBtn = document.querySelector('#cart-btn');
// Item Quantity -
var quantity = 1;

var addItem = [];

// Add Id & quantity of Food Item - 
function foodItemCartBtn(data_id, quantity, trimedEmailID, addItem){
    // Add Food ID to object
    var product = {
        FoodID: data_id,
        Quantity: quantity
    }
    // add that to last position
    addItem.push(product);

    // Save to Firebase DB
    firebase.database().ref('Users_Carts/' + trimedEmailID + '_Cart').set({
        Details: addItem
    });
}

function showUserCart(addItem){
  
    // Remove All Stored Previous items
    cartItemsContainer.innerHTML = ''
    
    addItem.forEach(item => {
        let id = item.FoodID - 1;
        var div = document.createElement('article');
        div.classList.add('cart-item')
        div.innerHTML = `
            <div><img src="${newMenu[id].fields.image.fields.file.url}" alt="Food item image"></div>
            <div class="cart-info">
                <h3 id'c-title'>${newMenu[id].fields.title}</h3>
                <p>${newMenu[id].fields.price}</p>
                <span class="remove-item" data-id=${id+1}>remove</span>
            </div>
            <div class="flex-column"> 
                <i class="fas fa-chevron-up" data-id=${id+1}></i>
                <p class="item-amount">${item.Quantity}</p>
                <i class="fas fa-chevron-down" data-id=${id+1}></i>
            </div>
        ` 
        cartItemsContainer.appendChild(div); 
    })
}

function cartFunctionalities (addItem, userEmailID, trimedEmailID, addToCartBtn){

    // In Cart Buttons & Functionalities -
    cartItemsContainer.addEventListener('click', event => {
        // When Remove Btn is clicked
        if (event.target.classList.contains('remove-item')){
            let removeBtn = event.target;
            let id = removeBtn.dataset.id;
            // cartItemsContainer.removeChild(removeBtn.parentElement.parentElement)

            // Remove Item From Array -
            addItem.forEach(item => {
                if (item.FoodID === id){ addItem.splice(addItem.indexOf(item) ,1) }
            })
            
            // Remove (i.e update) In Firebase DB
            firebase
            .database()
            .ref('Users_Carts/' + trimedEmailID + '_Cart')
            .update({Details: addItem})

        }
        // When Add Quantity is clicked
        else if (event.target.classList.contains('fa-chevron-up')){
            let addAmount = event.target;
            let id = addAmount.dataset.id;

            // Update Array -
            addItem.forEach(item => {                
                if (item.FoodID === id){
                    item.Quantity += 1;
                }
            })
            // Update in Firebase DB
            firebase.database()
            .ref('Users_Carts/' + trimedEmailID + '_Cart')
            .update({ Details: addItem })
        }
        // When lower Quantity is clicked
        else if (event.target.classList.contains('fa-chevron-down')){
            let lowerAmount = event.target;
            let id = lowerAmount.dataset.id;

            // Update Array -
            addItem.forEach(item => {                
                if (item.Quantity === 0){
                    lowerAmount.parentElement.parentElement.innerHTML = '';
                    // Enable Buttons - so user can use them again
                    addToCartBtn[id-1].disabled = false;
                    addToCartBtn[id-1].innerHTML = 'Add to Cart';
                    // Update Array -
                    addItem.splice(addItem.indexOf(item) ,1);
                }
                if (item.FoodID === id && item.Quantity >= 1){
                    item.Quantity -= 1;
                }
            })

            // Update in Firebase DB
            firebase
            .database()
            .ref('Users_Carts/' + trimedEmailID + '_Cart')
            .update({ Details: addItem })
        }
    })
}

// Main.js When Content Loaded
document.addEventListener('DOMContentLoaded', () =>{
    // Client UI
    displayMenuItems(newMenu);
    showUserCart(addItem)
    const addToCartBtn = document.querySelectorAll('#add-to-cart-btn');
    
    // When User Is logged In
    firebase.auth().onAuthStateChanged((user) => {
        if (user) {
            var userEmailID = user.email; console.log(userEmailID);
            var trimedEmailID = makeUserDataID(user.email);
            
            // Get Cart Items already stored
            firebase.database().ref('Users_Carts/' + trimedEmailID + '_Cart').on('value', function(snapshot){
                var userCart = snapshot.val().Details;
                // Empty Array
                addItem = []
                for (let i = 0; i< userCart.length; i++){
                    // Store previouly added items to array -
                    addItem.push(userCart[i])
                    // Disable already added items
                    addToCartBtn[userCart[i].FoodID-1].disabled =true;
                    addToCartBtn[userCart[i].FoodID-1].innerHTML = 'In Cart';
                }
                cartFunctionalities(addItem, userEmailID, trimedEmailID, addToCartBtn);
                showUserCart(addItem);
            })
            
            // Cart Buttons -
            addToCartBtn.forEach(btn => {
                btn.addEventListener('click', ()=> {
                    var quantity = 1;
                    const data_id = btn.dataset.id;
                    // Set Values In Firebase DB
                    foodItemCartBtn(data_id, quantity, trimedEmailID, addItem);
                });
            });

            // Remove all items from Cart -
            
            clearCart.addEventListener('click', ()=>{
                cartItemsContainer.innerHTML = '';

                // Update in Firebase DB
                firebase
                .database()
                .ref('Users_Carts/' + trimedEmailID + '_Cart')
                .remove()
            })

        } else {
        console.log('no user logged in');
        }
  });
});
